$klasor = "C:\yol"

# Liste.txt dosyasını temizle (varsa)
$listeDosyasi = Join-Path $klasor "liste.txt"
if (Test-Path $listeDosyasi) {
    Remove-Item $listeDosyasi
}

Get-ChildItem -Recurse -Filter *.prc -Path $klasor | ForEach-Object { 
    $line = Get-Content $_.FullName -TotalCount 1
    
    if ($line -match "\b[\w]+\.[\w]+\b" -or $line -match '([\w]+)\."([\w_]+)"') {
        if ($matches.Count -eq 3) {
            # Şema."prosedür" formatı - şema ve prosedürü birleştir
            $yeniIsim = ($matches[1] + "." + $matches[2]).ToUpper()
        } else {
            # Normal format
            $yeniIsim = $matches[0].ToUpper()
        }
        
        # Dosya uzantısını koru
        $uzanti = $_.Extension
        
        # Yeni dosya yolunu oluştur
        $yeniYol = Join-Path $_.Directory.FullName "$yeniIsim$uzanti"
        
        # Dosyayı yeniden adlandır
        try {
            Rename-Item -Path $_.FullName -NewName "$yeniIsim$uzanti" -ErrorAction Stop
            Write-Host "Başarılı: $($_.Name) -> $yeniIsim$uzanti" -ForegroundColor Green
            
            # Liste.txt'ye kaydet
            $yeniIsim | Out-File -FilePath $listeDosyasi -Append -Encoding UTF8
        }
        catch {
            Write-Host "Hata: $($_.Name) yeniden adlandırılamadı - $($_.Exception.Message)" -ForegroundColor Red
        }
    }
    else {
        Write-Host "Uygun isim bulunamadı: $($_.Name)" -ForegroundColor Yellow
    }
}
