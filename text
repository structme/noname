# PRC dosyalarını yeniden adlandırma script'i
# Klasör yolunu buraya girin
$rootPath = "C:\YourFolderPath"  # Bu yolu kendi klasör yolunuzla değiştirin

# Tüm .prc dosyalarını bul (alt klasörler dahil)
$prcFiles = Get-ChildItem -Path $rootPath -Filter "*.prc" -Recurse

Write-Host "Toplam $($prcFiles.Count) adet .prc dosyası bulundu." -ForegroundColor Green

foreach ($file in $prcFiles) {
    try {
        Write-Host "`nİşleniyor: $($file.FullName)" -ForegroundColor Yellow
        
        # Dosyanın ilk satırını oku
        $firstLine = Get-Content -Path $file.FullName -TotalCount 1
        
        if ([string]::IsNullOrWhiteSpace($firstLine)) {
            Write-Host "  UYARI: Dosya boş veya ilk satır boş - Atlanıyor" -ForegroundColor Red
            continue
        }
        
        Write-Host "  İlk satır: $firstLine" -ForegroundColor Cyan
        
        # İlk satırdan şema ve prosedür adını çıkar
        # Format: şema.pr_prosedüradi şeklinde olduğunu varsayıyoruz
        if ($firstLine -match "^(\w+)\.(\w+)") {
            $schema = $matches[1].ToUpper()
            $procedureName = $matches[2].ToUpper()
            
            # Yeni dosya adı
            $newFileName = "$schema.$procedureName.prc"
            $newFilePath = Join-Path -Path $file.DirectoryName -ChildPath $newFileName
            
            Write-Host "  Şema: $schema" -ForegroundColor Green
            Write-Host "  Prosedür: $procedureName" -ForegroundColor Green
            Write-Host "  Yeni dosya adı: $newFileName" -ForegroundColor Green
            
            # Eğer yeni dosya adı mevcut dosya adından farklıysa yeniden adlandır
            if ($file.FullName -ne $newFilePath) {
                # Hedef dosya zaten varsa kontrol et
                if (Test-Path -Path $newFilePath) {
                    Write-Host "  UYARI: Hedef dosya zaten mevcut - Atlanıyor" -ForegroundColor Red
                    continue
                }
                
                # Dosyayı yeniden adlandır
                Rename-Item -Path $file.FullName -NewName $newFileName
                Write-Host "  BAŞARILI: Dosya yeniden adlandırıldı" -ForegroundColor Green
            } else {
                Write-Host "  BİLGİ: Dosya adı zaten doğru formatta" -ForegroundColor Blue
            }
        } else {
            Write-Host "  HATA: İlk satır beklenen formatta değil (şema.prosedür)" -ForegroundColor Red
        }
        
    } catch {
        Write-Host "  HATA: $($_.Exception.Message)" -ForegroundColor Red
    }
}

Write-Host "`nİşlem tamamlandı!" -ForegroundColor Green
Read-Host "Çıkmak için Enter tuşuna basın"
